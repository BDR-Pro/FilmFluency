{% extends 'base.html' %}

{% block title %}Payment Home{% endblock %}

{% block styles %}
<style>
    .payment-method {
        display: flex;
        justify-content: space-between;
        margin-bottom: 30px;
    }
    .payment-method .card {
        border: 1px solid #ddd;
        padding: 20px;
        border-radius: 8px;
        width: 30%;
        text-align: center;
        cursor: pointer;
    }
    .payment-method .card:hover, .payment-method .card.active {
        border-color: #0d6efd;
        background: #e7f3ff;
    }
    .payment-method .card i {
        font-size: 2rem;
        margin-bottom: 10px;
    }
    .payment-method .card.active i {
        color: #0d6efd;
    }
    .product-info {
        margin-bottom: 20px;
    }
    .product-info h4 {
        margin-bottom: 15px;
        color: #333;
        font-weight: 500;
    }
    .product-info label {
        font-weight: bold;
    }
    .form-check-label {
        cursor: pointer;
    }
    .gift-option {
        margin-top: 10px;
    }
    .payment-method {
        display: flex;
        justify-content: space-between;
        margin-bottom: 30px;
        gap: 20px; /* Adds space between payment options */
    }
    .payment-method .card {
        border: 1px solid #ddd;
        padding: 20px;
        border-radius: 8px;
        width: 100%; /* Ensure full width within the flex item */
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease; /* Smooth transition for hover effects */
    }
    .payment-method .card:hover, .payment-method .card.active {
        border-color: #0d6efd;
        background: #e7f3ff;
        transform: translateY(-5px); /* Lift card on hover */
    }
    .payment-method .card i {
        font-size: 2rem;
        margin-bottom: 10px;
    }
    .payment-method .card.active i {
        color: #0d6efd;
    }
    .product-info {
        margin-bottom: 20px;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .product-info h4 {
        margin-bottom: 15px;
        color: #333;
        font-weight: bold;
    }
    .product-info img {
        width: 100%;
        height: auto;
        max-height: 300px;
        object-fit: cover;
        border-radius: 8px;
        margin-bottom: 20px;
    }
    .product-info p, .product-info label {
        font-size: 16px;
        line-height: 1.6;
        color: #666;
    }
    .product-info label {
        font-weight: bold;
        color: #000;
    }
    .form-check-label {
        cursor: pointer;
        display: block; /* Makes the label take up the full line */
    }
    .gift-option {
        margin-top: 10px;
    }
    
    .form-select {
        display: block;
        width: 100%;
        padding: 0.375rem 1.75rem 0.375rem 0.75rem;
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.5;
        color: #495057;
        background-color: #fff;
        background-clip: padding-box;
        border: 1px solid #ced4da;
        border-radius: 0.25rem;
        transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
    }
    .btn-primary {
        background-color: #6c757d; /* Bootstrap's secondary color */
        color: white;
        border: none;
        padding: 10px 30px;
        font-size: 18px;
        width: 100%; /* Make the button long to fill the container */
        border-radius: 5px;
        transition: background-color 0.3s;
    }
    
    .btn-primary:hover {
        background-color: #5a6268; /* Darker shade on hover */
    }
    
</style>
{% endblock %}

{% block content %}
<div class="container">
    <h2 class="text-center mb-4">Payment</h2>
    <div class="payment-method">
        <div class="card active" data-payment-type="tap">
            <i class="bi bi-credit-card-2-front-fill"></i>
            <p>Pay with Tap</p>
        </div>
        <div class="card" data-payment-type="crypto">
            <i class="bi bi-currency-bitcoin"></i>
            <p>Pay with Crypto</p>
        </div>
    </div>
    <div class="product-info">
        <h4>Product Details</h4>
        <img src="{{ product.image }}" alt="Product Image">
        <p><label>Name:</label> {{ product.name }}</p>
        <p><label>Price:</label> ${{ product.price }}</p>
        <div class="input-group mb-3">
            <button class="btn btn-outline-secondary" type="button" onclick="decreaseQuantity()">-</button>
            <input type="text" class="form-control text-center" id="quantityInput" value="1" readonly>
            <button class="btn btn-outline-secondary" type="button" onclick="increaseQuantity()">+</button>
        </div>
         <div class="mb-3">
            <label for="subscriptionType" class="form-label"><strong>Type of Subscription:</strong></label>
            <select class="form-select" id="subscriptionType">
                <option value="{{ product.id }}" disabled selected>{{ product.days }} Days</option>
                {% for subscription in subscriptions %}
                {% if subscription.days != product.days %}
                <option value="{{ subscription.days }}" disabled>{{ subscription.days }} Days</option>
                {% endif %}
                {% endfor %}
            </select>
            <small class="form-text text-muted">if you want to change the type of subscription go back.</small>
        </div>
        <p><label>Description:</label> {{ product.description }}</p>
        <div class="form-check gift-option">
            <input class="form-check-input" type="checkbox" id="giftCheckbox">
            <label class="form-check-label" for="giftCheckbox">Make this a gift</label>
        </div>
        <button class="btn btn-primary" onclick="createToken()">Submit Payment</button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const paymentCards = document.querySelectorAll('.payment-method .card');
        paymentCards.forEach(card => {
            card.addEventListener('click', function() {
                paymentCards.forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                const paymentType = this.getAttribute('data-payment-type');
                
            });
        });
    });
    
</script>

<script>
    function increaseQuantity() {
        var input = document.getElementById('quantityInput');
        var currentValue = parseInt(input.value, 10);
        input.value = currentValue + 1;
    }
    
    function decreaseQuantity() {
        var input = document.getElementById('quantityInput');
        var currentValue = parseInt(input.value, 10);
        if (currentValue > 1) { // Prevents quantity from going below 1
            input.value = currentValue - 1;
        }
    }
    </script>

<script>
    function createToken() {
        const quantity = document.getElementById('quantityInput').value;
        const subscriptionType = document.getElementById('subscriptionType').value;
        const isGift = document.getElementById('giftCheckbox').checked;
        const paymentType = document.querySelector('.payment-method .card.active').getAttribute('data-payment-type');
        ///alert(`Payment details:\nQuantity: ${quantity}\nSubscription Type: ${subscriptionType}\nGift: ${isGift ? 'Yes' : 'No'}\nPayment Type: ${paymentType}`);
        //send it as a POST request to the server
        fetch('/payment/create-token/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({
                quantity: quantity,
                subscriptionType: subscriptionType,
                isGift: isGift,
                paymentType: paymentType
            })
        })
        //wait to redirect to the payment page
        


    }
</script>
{% endblock %}
