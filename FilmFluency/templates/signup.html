{% extends 'base.html' %}

{% block title %}Sign Up{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2>Sign Up</h2>
    {% if error %}
    <div class="alert alert-danger" role="alert">
        {{ error }}
    </div>
    {% endif %}
    <form method="post" class="needs-validation" novalidate>
        {% csrf_token %}
        {% for field in form %}
        <div class="mb-3">
            <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
            <input type="{{ field.field.widget.input_type }}" class="form-control {% if field.errors %}is-invalid{% endif %}"
                   id="{{ field.id_for_label }}" name="{{ field.name }}"
                   placeholder="Enter {{ field.label }}" {% if field.field.required %}required{% endif %}
                   {% if field.name == 'email' %}oninput="validateEmail(this)"{% endif %}
                   {% if field.name == 'password1' %}onkeyup="checkPasswordStrength();" {% endif %}>
            <div class="invalid-feedback">
                {% for error in field.errors %}
                {{ error }}
                {% endfor %}
            </div>
            {% if field.help_text %}
            <div class="form-text">{{ field.help_text }}</div>
            {% endif %}
        </div>
        {% endfor %}
        <div class="mb-3" id="passwordStrength" style="display: none;">
            <p class="form-text">Password Strength: <span id="passwordStrengthValue"></span></p>
        </div>
        <button type="submit" class="btn btn-primary">Sign up</button>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function validateEmail(input) {
        const re = /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$/;
        const feedbackElement = input.nextElementSibling;
        if (re.test(input.value)) {
            input.classList.remove('is-invalid');
            feedbackElement.style.display = 'none';
        } else {
            input.classList.add('is-invalid');
            feedbackElement.style.display = 'block';
        }
    }

    function checkPasswordStrength() {
        var passwordInput = document.querySelector('[name="password1"]');
        var passwordValue = passwordInput.value;
        var strengthText = document.getElementById('passwordStrengthValue');
        var strengthIndicator = document.getElementById('passwordStrength');
    
        var strongRegex = new RegExp('^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*])(?=.{8,})');
        var mediumRegex = new RegExp('^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.{6,})');
    
        if(strongRegex.test(passwordValue)) {
            strengthText.innerHTML = 'Strong';
            strengthText.style.color = 'green';
            strengthIndicator.style.display = 'block';
        } else if(mediumRegex.test(passwordValue)) {
            strengthText.innerHTML = 'Medium';
            strengthText.style.color = 'orange';
            strengthIndicator.style.display = 'block';
        } else {
            strengthText.innerHTML = 'Weak';
            strengthText.style.color = 'red';
            strengthIndicator.style.display = 'block';
        }
    }

    // JavaScript for disabling form submissions if there are invalid fields
    (function () {
      'use strict'
      var forms = document.querySelectorAll('.needs-validation')
    
      Array.prototype.slice.call(forms)
        .forEach(function (form) {
          form.addEventListener('submit', function (event) {
            if (!form.checkValidity()) {
              event.preventDefault()
              event.stopPropagation()
            }
    
            form.classList.add('was-validated')
          }, false)
        })
    })();
</script>
{% endblock %}
